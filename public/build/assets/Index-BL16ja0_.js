import{c as p,o as u,a,u as xt,r as F,L as j,H as Qt,G as Ae,b as ue,D as eo,E as to,d as oo,g as P,e as oe,w as ao,h as v,t as y,l as Ke,n as xe,F as de,j as we,f as Oe,v as Ue,I as mt,k as pe,J as yt,T as ro,q as so,p as ge}from"./app-C52ltky6.js";import{_ as no}from"./logo-C5fiQHXv.js";import{i as lo,u as io}from"./reactive-CE6PgxrA.js";import{A as co}from"./ARNavigation-JCGOMB-5.js";import{_ as uo}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as po,a as go}from"./Square3Stack3DIcon-C3O_-PgU.js";import{r as vo}from"./ClockIcon-CXAczcgc.js";import{r as We}from"./XMarkIcon-CsLPvjjO.js";import{r as bt}from"./MagnifyingGlassIcon-ClrjfHuK.js";/* empty css            */const ho=V=>lo(V,'<svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10Zm4.5-14.5L10 10l-2.5 6.5L14 14zM12 13a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');function fo(V,T){return u(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function wt(){const V=(s,x,h,_)=>{const L=s*Math.PI/180,i=h*Math.PI/180,R=(h-s)*Math.PI/180,$=(_-x)*Math.PI/180,E=Math.sin(R/2)*Math.sin(R/2)+Math.cos(L)*Math.cos(i)*Math.sin($/2)*Math.sin($/2);return 6371e3*(2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E)))},T=(s,x,h,_)=>{const C=s*Math.PI/180,L=h*Math.PI/180,i=(_-x)*Math.PI/180,R=Math.sin(i)*Math.cos(L),$=Math.cos(C)*Math.sin(L)-Math.sin(C)*Math.cos(L)*Math.cos(i);return(Math.atan2(R,$)*180/Math.PI+360)%360},g=s=>{const x=[{min:0,max:22.5,text:"north",icon:"‚¨ÜÔ∏è"},{min:22.5,max:67.5,text:"northeast",icon:"‚ÜóÔ∏è"},{min:67.5,max:112.5,text:"east",icon:"‚û°Ô∏è"},{min:112.5,max:157.5,text:"southeast",icon:"‚ÜòÔ∏è"},{min:157.5,max:202.5,text:"south",icon:"‚¨áÔ∏è"},{min:202.5,max:247.5,text:"southwest",icon:"‚ÜôÔ∏è"},{min:247.5,max:292.5,text:"west",icon:"‚¨ÖÔ∏è"},{min:292.5,max:337.5,text:"northwest",icon:"‚ÜñÔ∏è"},{min:337.5,max:360,text:"north",icon:"‚¨ÜÔ∏è"}];for(const h of x)if(s>=h.min&&s<h.max)return h;return x[0]},H=(s,x,h)=>{const _=T(s.lat,s.lng,x.lat,x.lng);let L=T(x.lat,x.lng,h.lat,h.lng)-_;return L>180&&(L-=360),L<-180&&(L+=360),L},te=s=>Math.abs(s)<20?{text:"Continue straight",icon:"‚¨ÜÔ∏è"}:s>20&&s<70?{text:"Turn slight right",icon:"‚ÜóÔ∏è"}:s>=70&&s<120?{text:"Turn right",icon:"‚û°Ô∏è"}:s>=120?{text:"Turn sharp right",icon:"‚Ü™Ô∏è"}:s<-20&&s>-70?{text:"Turn slight left",icon:"‚ÜñÔ∏è"}:s<=-70&&s>-120?{text:"Turn left",icon:"‚¨ÖÔ∏è"}:s<=-120?{text:"Turn sharp left",icon:"‚Ü©Ô∏è"}:{text:"Continue",icon:"‚¨ÜÔ∏è"},Z=(s,x)=>{let h=0,_=1/0;return x.forEach((C,L)=>{const i=V(s.lat,s.lng,C[1],C[0]);i<_&&(_=i,h=L)}),{index:h,coord:x[h],distance:_}},O=(s,x,h=30)=>{let _=null,C=null,L=1/0;return x.forEach(i=>{if(i.geometry.type==="LineString"){const R=i.geometry.coordinates,$=Z(s,R);$.distance<L&&(L=$.distance,_=i,C=$)}}),L<=h?{feature:_,point:C}:null},N=async(s,x,h)=>{try{const C=`https://router.project-osrm.org/route/v1/${h==="driving"?"driving":h==="riding"?"cycling":"walking"}/${s.lng},${s.lat};${x.lng},${x.lat}?overview=full&geometries=geojson`,i=await(await fetch(C)).json();if(i.code==="Ok"&&i.routes.length>0)return i.routes[0].geometry.coordinates.map(([$,E])=>({lat:E,lng:$}))}catch(_){console.error("OSRM routing error:",_)}return null},A=s=>{const x=new Map,h=new Map,_=(C,L)=>{const i=`${C.toFixed(6)},${L.toFixed(6)}`;if(!h.has(i)){const R=`node_${h.size}`;h.set(i,R),x.set(R,{id:R,lat:C,lng:L,neighbors:[]})}return h.get(i)};return s.forEach(C=>{if(C.geometry.type!=="LineString")return;const L=C.geometry.coordinates;let i=null;L.forEach(([R,$])=>{const E=_($,R),w=x.get(E);if(i){const Y=x.get(i),Q=V(Y.lat,Y.lng,$,R);w.neighbors.some(se=>se.id===i)||w.neighbors.push({id:i,cost:Q}),Y.neighbors.some(se=>se.id===E)||Y.neighbors.push({id:E,cost:Q})}i=E})}),console.log(`Built graph with ${x.size} nodes`),x},X=(s,x,h=100)=>{let _=null,C=1/0;for(const[L,i]of x.entries()){const R=V(s.lat,s.lng,i.lat,i.lng);R<C&&R<=h&&(C=R,_=L)}return _},r=(s,x,h)=>{if(!h.has(s)||!h.has(x))return console.warn("Start or goal node not in graph"),null;if(s===x){const K=h.get(s);return[{lat:K.lat,lng:K.lng}]}const _=new Set,C=new Map,L=new Map,i=new Map;class R{constructor(){this.heap=[]}push(U,d){this.heap.push({item:U,priority:d}),this.bubbleUp(this.heap.length-1)}pop(){if(this.heap.length===0)return null;const U=this.heap[0].item,d=this.heap.pop();return this.heap.length>0&&(this.heap[0]=d,this.bubbleDown(0)),U}bubbleUp(U){for(;U>0;){const d=Math.floor((U-1)/2);if(this.heap[U].priority>=this.heap[d].priority)break;[this.heap[U],this.heap[d]]=[this.heap[d],this.heap[U]],U=d}}bubbleDown(U){for(;;){let d=U;const ne=2*U+1,J=2*U+2;if(ne<this.heap.length&&this.heap[ne].priority<this.heap[d].priority&&(d=ne),J<this.heap.length&&this.heap[J].priority<this.heap[d].priority&&(d=J),d===U)break;[this.heap[U],this.heap[d]]=[this.heap[d],this.heap[U]],U=d}}isEmpty(){return this.heap.length===0}}const $=new R;L.set(s,0);const E=h.get(s),w=h.get(x),Y=(K,U)=>V(K.lat,K.lng,U.lat,U.lng)*.95;i.set(s,Y(E,w)),$.push(s,i.get(s));let Q=0;const se=h.size*2;for(;!$.isEmpty()&&Q<se;){Q++;const K=$.pop();if(K===x)return console.log(`‚úÖ Path found in ${Q} iterations`),M(C,K,h);if(_.has(K))continue;_.add(K);const U=h.get(K);if(!U)continue;const d=L.get(K)||1/0;for(const ne of U.neighbors){const J=ne.id;if(_.has(J))continue;const le=h.get(J);if(!le)continue;const ve=d+ne.cost;if(!L.has(J)||ve<L.get(J)){C.set(J,K),L.set(J,ve);const Me=ve+Y(le,w);i.set(J,Me),$.push(J,Me)}}}return console.warn(`‚ö†Ô∏è No path found after ${Q} iterations`),null},M=(s,x,h)=>{const _=[];let C=x;for(;C;){const L=h.get(C);_.unshift({lat:L.lat,lng:L.lng}),C=s.get(C)}return _};return{calculateDistance:V,calculateBearing:T,getDirection:g,calculateTurnAngle:H,getTurnInstruction:te,getNearestPointOnLine:Z,findClickedLineString:O,getPublicRoute:N,buildCampusGraph:A,findNearestNode:X,findPathAStar:r,calculateRouteDistance:s=>{let x=0;for(let h=0;h<s.length-1;h++)x+=V(s[h].lat,s[h].lng,s[h+1].lat,s[h+1].lng);return x},findCampusEntrances:s=>{const x=[];for(const[h,_]of s.entries())x.push({id:h,lat:_.lat,lng:_.lng,node:_});return x},generateEnhancedInstructions:(s,x)=>{if(!s||s.length<2)return[{icon:"üìç",text:"You are at your destination",distance:"0 m"}];const h=[];let _=0;const C=7,L=T(s[0].lat,s[0].lng,s[1].lat,s[1].lng),i=g(L);h.push({icon:"üö∂",text:`Start heading ${i.text}`,distance:"0 m",bearing:L.toFixed(0)+"¬∞"});let R=0;for(let w=0;w<s.length-1;w++)R+=V(s[w].lat,s[w].lng,s[w+1].lat,s[w+1].lng);const $=[];_=0;for(let w=1;w<s.length-1;w++){const Y=V(s[w-1].lat,s[w-1].lng,s[w].lat,s[w].lng);_+=Y;const Q=H(s[w-1],s[w],s[w+1]);if(Math.abs(Q)>20){const se=T(s[w].lat,s[w].lng,s[w+1].lat,s[w+1].lng);$.push({index:w,angle:Q,distance:_,bearing:se})}}if(x&&R>100){const w=R/2;h.push({icon:"üè´",text:"Enter campus grounds",distance:`${Math.round(w)} m`})}const E=C-2-(x?1:0);return $.length>E&&($.sort((w,Y)=>Math.abs(Y.angle)-Math.abs(w.angle)),$.splice(E),$.sort((w,Y)=>w.distance-Y.distance)),$.forEach(w=>{const Y=te(w.angle);h.push({icon:Y.icon,text:Y.text,distance:`${Math.round(w.distance)} m`,bearing:w.bearing.toFixed(0)+"¬∞"})}),h.push({icon:"üéØ",text:"You have arrived at your destination",distance:`${Math.round(R)} m`}),h.length>C?[h[0],...h.slice(-Math.min(5,C-2)),h[h.length-1]].slice(0,C):h}}}function mo(){const V=xt(),{calculateDistance:T}=wt(),g=F(null),H=F(null),te=F(null),Z=F(null),O=(r,M)=>{if(!(!M||!r||!r.accuracy))try{Z.value&&M.hasLayer&&M.hasLayer(Z.value)&&(M.removeLayer(Z.value),Z.value=null),r.accuracy<100&&(Z.value=j.circle([r.lat,r.lng],{radius:r.accuracy,color:"#3388ff",fillColor:"#3388ff",fillOpacity:.1,weight:1,opacity:.5}).addTo(M),Z.value.bindTooltip(`GPS Accuracy: ${Math.round(r.accuracy)}m`,{permanent:!1,direction:"top",offset:[0,-10]}))}catch(z){console.warn("Error updating accuracy circle:",z)}},N=(r,M,z)=>{if(!g.value||!M){console.warn("Cannot update user marker: missing location or map");return}try{if(H.value&&typeof H.value.setLatLng=="function"&&M.hasLayer&&M.hasLayer(H.value)){H.value.setLatLng([g.value.lat,g.value.lng]);const S=`
          <div style="font-size: 13px; color: #1f2937; font-weight: 500;">
            ${r.nickname||"You"}
            ${g.value.accuracy?`<br><small style="color: #6b7280;">Accuracy: ${Math.round(g.value.accuracy)}m</small>`:""}
          </div>
        `;H.value.setPopupContent(S)}else{console.log("Creating new user marker..."),H.value=j.marker([g.value.lat,g.value.lng],{title:r.nickname||"You",draggable:!0,autoPan:!0,zIndexOffset:1e3,icon:j.divIcon({className:"user-location-marker",html:`
              <div style="
                background: #3388ff;
                border: 3px solid white;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                animation: pulse 2s infinite;
              "></div>
            `,iconSize:[20,20],iconAnchor:[10,10]})}).addTo(M),H.value.on("dragend",G=>{const x=G.target.getLatLng();g.value={lat:parseFloat(x.lat.toFixed(8)),lng:parseFloat(x.lng.toFixed(8)),accuracy:g.value?.accuracy||10,isManual:!0},console.log("Marker dragged to:",g.value),O(g.value,M),z&&z(g.value),V.info("Location updated manually")});const S=`
          <div style="font-size: 13px; color: #1f2937; font-weight: 500;">
            ${r.nickname||"You"}
            ${g.value.accuracy?`<br><small style="color: #6b7280;">Accuracy: ${Math.round(g.value.accuracy)}m</small>`:""}
            ${g.value.isManual?'<br><small style="color: #f59e0b;">üìç Manually placed</small>':""}
          </div>
        `;H.value.bindPopup(S,{offset:[0,-12],closeButton:!1,autoPan:!1,className:"user-popup"}),r.nickname&&setTimeout(()=>{H.value&&!H.value.isPopupOpen()&&(H.value.openPopup(),setTimeout(()=>H.value.closePopup(),3e3))},1e3)}}catch(S){console.error("Error updating user marker:",S),H.value=null}},A=(r,M,z)=>{if(!navigator.geolocation){console.error("Geolocation not supported"),V.error("Geolocation is not supported by your browser");return}if(!M){console.warn("Cannot start tracking: map not initialized");return}console.log("Starting GPS tracking with real-time updates..."),te.value=navigator.geolocation.watchPosition(S=>{if(!M){console.warn("Map destroyed during GPS update, stopping tracking"),X(M);return}const G={lat:parseFloat(S.coords.latitude.toFixed(8)),lng:parseFloat(S.coords.longitude.toFixed(8)),accuracy:S.coords.accuracy,heading:S.coords.heading,speed:S.coords.speed};if(console.log("GPS Update:",{position:`${G.lat.toFixed(8)}, ${G.lng.toFixed(8)}`,accuracy:`${Math.round(G.accuracy)}m`,heading:G.heading,speed:G.speed}),g.value){const s=T(g.value.lat,g.value.lng,G.lat,G.lng),x=G.accuracy<g.value.accuracy*.7;(s>2||x)&&(g.value=G,N(r,M,z),O(G,M),z&&z(G))}else g.value=G,N(r,M,z),O(G,M),V.success(`GPS acquired! Accuracy: ${Math.round(G.accuracy)}m`)},S=>{console.error("Geolocation watch error:",S);let G="GPS signal lost";switch(S.code){case S.PERMISSION_DENIED:G="GPS permission denied. Please enable location services.";break;case S.POSITION_UNAVAILABLE:G="GPS position unavailable. Check your location settings.";break;case S.TIMEOUT:G="GPS timeout. Trying to reconnect...",setTimeout(()=>A(r,M,z),2e3);break}console.warn(G),g.value||(g.value={lat:8.169,lng:126.003},N(r,M,z))},{enableHighAccuracy:!0,timeout:5e3,maximumAge:2e3})},X=r=>{if(te.value!==null&&(navigator.geolocation.clearWatch(te.value),te.value=null,console.log("GPS tracking stopped")),Z.value&&r&&r.hasLayer&&r.hasLayer(Z.value)){try{r.removeLayer(Z.value)}catch(M){console.warn("Error removing accuracy circle:",M)}Z.value=null}if(H.value&&r&&r.hasLayer&&r.hasLayer(H.value)){try{r.removeLayer(H.value)}catch(M){console.warn("Error removing user marker:",M)}H.value=null}};return{userLocation:g,userMarker:H,watchId:te,accuracyCircle:Z,startTracking:A,stopTracking:X,updateUserMarker:N,updateAccuracyCircle:O}}function yo(){const V=F([]),T=F([]);return{facilityMarkers:V,polygonLayers:T,markerTypeIcons:{academic:"üéì",library:"üìö",laboratory:"üî¨",office:"üíº",cafeteria:"üçΩÔ∏è",sports:"üèÉ",dormitory:"üõèÔ∏è",parking:"üöó",medical:"‚öïÔ∏è",building:"üèõÔ∏è",classroom:"‚úèÔ∏è",administration:"üìã",auditorium:"üé≠",gymnasium:"üèÄ",theater:"üé¨",studio:"üé®",workshop:"üîß",conference:"üë•",entrance:"üö™",exit:"üö∂",restroom:"üöª",garden:"üå≥",plaza:"üèûÔ∏è",fountain:"‚õ≤",statue:"üóø",gate:"üöß",security:"üîí",it:"üíª",maintenance:"üõ†Ô∏è",storage:"üì¶",default:"üìå"},addFacilityMarker:(O,N)=>{if(!N||!N.addLayer){console.warn("Cannot add marker: map not ready");return}try{const A=j.marker([O.lat,O.lng],{title:O.name,icon:j.divIcon({className:"facility-marker",html:`
            <div style="
              background: white;
              border: 1px solid #3B82F6;
              border-radius: 50%;
              width: 20px;
              height: 20px;
              display: flex;
              align-items: center;
              justify-content: center;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              font-size: 16px;
            ">
              ${O.icon}
            </div>
          `,iconSize:[40,40],iconAnchor:[20,20]})}).addTo(N);return V.value.push(A),A}catch(A){return console.error("Error adding facility marker:",A),null}},displayPolygons:(O,N)=>{if(!N||!O||!Array.isArray(O)){console.warn("Cannot display polygons: map or data not ready");return}T.value.forEach(A=>{if(N&&N.hasLayer&&N.hasLayer(A))try{N.removeLayer(A)}catch(X){console.warn("Error removing polygon layer:",X)}}),T.value=[],O.forEach(A=>{if(!A.coordinates||!Array.isArray(A.coordinates)){console.warn("Invalid polygon coordinates:",A);return}try{const X=A.coordinates.map(M=>[M.lat,M.lng]),r=j.polygon(X,{color:A.color||"#3B82F6",fillColor:A.fill_color||"#3B82F6",fillOpacity:A.fill_opacity||.3,weight:3,opacity:.9,lineCap:"round",lineJoin:"round"});A.name&&r.bindTooltip(A.name,{permanent:!1,direction:"center",className:"polygon-tooltip",opacity:.9}),r.on("mouseover",function(M){M.target.setStyle({fillOpacity:.5,weight:4})}),r.on("mouseout",function(M){M.target.setStyle({fillOpacity:A.fill_opacity||.3,weight:3})}),N&&N.addLayer&&(r.addTo(N),T.value.push(r))}catch(X){console.error("Error creating polygon:",A,X)}})},cleanup:O=>{O&&(V.value.forEach(N=>{if(O.hasLayer&&O.hasLayer(N))try{O.removeLayer(N)}catch(A){console.warn("Error removing facility marker:",A)}}),V.value=[],T.value.forEach(N=>{if(O.hasLayer&&O.hasLayer(N))try{O.removeLayer(N)}catch(A){console.warn("Error removing polygon layer:",A)}}),T.value=[])}}}const bo={class:"relative flex h-screen w-full"},xo={key:0,class:"z-20 flex flex-col border-gray-200 bg-white shadow-xl fixed bottom-0 left-0 right-0 max-h-[85vh] rounded-t-2xl md:relative md:h-full md:w-full md:max-w-md md:border-r md:rounded-none md:max-h-full"},wo={class:"relative border-b border-gray-200 bg-white shadow-sm"},ko={class:"px-4 py-3"},_o={class:"flex items-start justify-between gap-3"},So={class:"flex-1 min-w-0"},Lo={class:"flex items-center gap-3 mb-2"},Mo={class:"flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-lg bg-gray-50 border border-gray-200 text-2xl shadow-sm"},Po={class:"min-w-0"},Co={class:"text-sm font-bold text-gray-900 leading-tight truncate"},Eo={class:"flex items-center gap-2 mt-0.5"},No={class:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-green-50 text-green-700 border border-green-100 uppercase tracking-wide"},Ao={key:0,class:"text-[10px] text-gray-500 truncate"},$o={class:"grid grid-cols-2 gap-x-2 gap-y-1.5 mt-2 bg-gray-50/50 rounded-md p-2 border border-gray-100"},Io={key:0,class:"flex items-center gap-1.5 min-w-0"},Fo={class:"text-[11px] font-medium text-gray-700 truncate",title:"Location"},To={key:1,class:"flex items-center gap-1.5 min-w-0"},Ro={class:"text-[11px] font-medium text-gray-700 truncate"},Do={key:2,class:"col-span-2 flex items-start gap-1.5 min-w-0 pt-1 border-t border-gray-100"},zo={class:"text-[11px] font-medium text-gray-700 leading-snug"},Go={class:"flex-1 overflow-y-auto bg-gray-50"},jo={class:"space-y-4 px-4 py-4 bg-white"},Bo={key:0,class:"text-sm leading-relaxed text-gray-600"},Oo={class:"flex flex-wrap gap-2"},Uo=["disabled","title"],Vo={key:1,class:"rounded-lg border border-gray-200 bg-white shadow-sm"},Ho={class:"whitespace-pre-line px-3 py-3 text-sm text-gray-700"},Jo={key:2,class:"rounded-lg border border-gray-200 bg-white shadow-sm"},Zo={class:"mt-0.5 text-lg"},Yo={class:"flex-1"},Ko={class:"text-sm font-medium text-gray-800"},Wo={class:"text-xs text-gray-500"},Xo={class:"border-t border-gray-200 px-4 py-4 bg-white"},qo={class:"mb-3 flex items-center justify-between"},Qo={class:"text-xs text-gray-500"},ea={class:"space-y-3"},ta={class:"rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-4 text-center hover:border-gray-400 transition"},oa={key:0,class:"space-y-2"},aa={key:1,class:"space-y-3"},ra=["src"],sa={class:"flex justify-end gap-2"},na=["disabled"],la={key:0,class:"space-y-3"},ia={class:"grid grid-cols-2 gap-3"},ca=["onClick"],ua=["src","alt"],da={class:"space-y-1 px-3 py-2 bg-gray-50"},pa={class:"text-xs font-medium text-gray-900 truncate"},ga={class:"text-[11px] text-gray-500"},va={key:1,class:"text-center text-sm text-gray-500"},ha={class:"border-t border-gray-200 px-4 py-4 space-y-3 bg-white"},fa={class:"flex items-center justify-between"},ma={class:"text-xs text-gray-500"},ya={class:"text-xs text-gray-500 bg-green-50 border border-green-200 rounded-lg px-3 py-2 space-y-1"},ba={key:0,class:"space-y-2 rounded-lg border border-gray-300 bg-gray-50 p-3 shadow-sm"},xa={class:"flex justify-end gap-2"},wa=["disabled"],ka={key:1},_a={key:2,class:"space-y-3"},Sa={class:"flex items-start justify-between gap-3"},La={class:"text-xs font-semibold text-gray-700"},Ma={key:0,class:"text-green-700"},Pa={class:"text-xs text-gray-500"},Ca=["onClick"],Ea={class:"mt-2 text-sm text-gray-800 leading-relaxed"},Na={key:3,class:"text-center text-sm text-gray-500"},Aa={class:"border-t border-gray-200 px-4 py-4 space-y-3 bg-white"},$a={class:"flex items-center justify-between"},Ia={class:"text-xs text-gray-500"},Fa={key:0,class:"space-y-2 rounded-lg border border-gray-300 bg-gray-50 p-3 shadow-sm"},Ta={class:"flex justify-end gap-2"},Ra=["disabled"],Da={key:1},za={key:2,class:"space-y-2"},Ga={class:"max-h-60 overflow-y-auto space-y-3 pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"},ja={class:"flex items-center justify-between"},Ba={class:"text-sm font-semibold text-gray-800"},Oa={class:"text-xs text-gray-500"},Ua={class:"mt-2 text-sm text-gray-700"},Va={key:3,class:"text-sm text-gray-500 text-center"},Ha={class:"relative flex-1"},Ja={key:0,class:"absolute top-4 left-4 right-4 sm:left-1/2 sm:right-auto sm:-translate-x-1/2 sm:transform z-10 sm:w-full sm:max-w-2xl sm:px-4"},Za={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Ya={class:"relative"},Ka={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3.5"},Wa={key:0,class:"border-t border-gray-200 bg-white"},Xa={key:0,class:"px-4 py-8 text-center"},qa={key:1,class:"px-4 py-8 text-center"},Qa={class:"w-12 h-12 mx-auto rounded-full bg-gray-100 flex items-center justify-center"},er={key:2,class:"max-h-[70vh] overflow-y-auto"},tr={class:"sticky top-0 z-10 bg-white px-4 py-2 border-b border-gray-100"},or={class:"text-[10px] font-semibold text-gray-500 uppercase tracking-wider"},ar={class:"divide-y divide-gray-100"},rr=["onClick"],sr={class:"flex-shrink-0 w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-green-50 transition-colors"},nr={class:"text-lg group-hover:scale-105 transition-transform"},lr={class:"min-w-0 flex-1 space-y-2"},ir={class:"flex items-start justify-between gap-2"},cr={class:"font-semibold text-gray-900 text-xs leading-tight group-hover:text-green-700 transition-colors"},ur={class:"flex-shrink-0 text-[10px] font-medium text-gray-500 bg-gray-100 px-2 py-0.5 rounded"},dr={class:"flex flex-wrap items-center gap-1.5"},pr={class:"inline-flex items-center px-2 py-0.5 rounded-md bg-green-50 border border-green-200 text-green-700 text-[10px] font-medium"},gr={class:"inline-flex items-center px-2 py-0.5 rounded-md bg-blue-50 border border-blue-200 text-blue-700 text-[10px] font-medium"},vr={key:0,class:"text-[11px] text-gray-600 leading-relaxed line-clamp-2"},hr={key:1,class:"grid grid-cols-2 gap-x-4 gap-y-1 pt-1 border-t border-gray-100"},fr={key:0,class:"flex items-center gap-1.5"},mr={class:"text-[10px] text-gray-600"},yr={class:"font-medium text-gray-900"},br={key:1,class:"flex items-center gap-1.5"},xr={class:"text-[10px] text-gray-600"},wr={class:"font-medium text-gray-900"},kr={key:2,class:"flex items-center gap-1.5"},_r={class:"text-[10px] text-gray-600 capitalize"},Sr={key:3,class:"flex items-center gap-1.5"},Lr={class:"text-[10px] text-gray-600"},Mr={key:1,class:"absolute bottom-4 left-4 z-10"},Pr={class:"flex max-w-[calc(100vw-6rem)] flex-wrap gap-1 rounded-lg bg-white p-1.5 shadow-lg sm:max-w-none sm:p-2"},Cr=["onClick","title"],Er={class:"text-base sm:text-lg"},Nr={class:"hidden text-xs lg:inline"},Ar={key:2,class:"absolute top-4 right-4 z-10"},$r={class:"flex items-center gap-2 rounded-lg bg-white px-3 py-2 shadow-lg sm:px-4"},Ir={class:"hidden text-left sm:block"},Fr={class:"max-w-[120px] truncate text-xs font-semibold text-gray-900"},Tr={class:"text-xs text-gray-500"},Rr={key:3,class:"absolute left-4 top-20 hidden w-64 rounded-lg border border-gray-200 bg-white shadow-lg sm:block sm:w-72"},Dr={class:"flex items-center justify-between border-b border-gray-200 bg-green-900 px-3 py-2"},zr={class:"max-h-40 overflow-y-auto px-3 py-2 text-xs leading-relaxed text-gray-700"},Gr={key:4,class:"absolute bottom-20 left-4 right-4 z-20 flex max-h-52 flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-lg sm:bottom-4 sm:left-auto sm:w-72"},jr={class:"flex items-center justify-between border-b border-gray-200 bg-green-900 px-3 py-2"},Br={class:"mt-0.5 text-sm"},Or={class:"min-w-0 flex-1"},Ur={class:"font-medium text-gray-900"},Vr={class:"text-gray-500"},Hr={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 p-4"},Jr={class:"relative w-full max-w-sm rounded-lg bg-white shadow-2xl"},Zr={key:0,class:"p-6 sm:p-8"},Yr={class:"space-y-4"},Kr=["disabled"],Wr={key:1,class:"p-6 sm:p-8"},Xr={class:"mb-6 space-y-3"},qr=["onClick"],Qr={class:"text-xl sm:text-2xl"},es={class:"text-sm font-medium text-gray-900"},ts={class:"space-y-2"},os=["disabled"],as={class:"relative bg-white rounded-lg overflow-hidden shadow-2xl"},rs=["src","alt"],ss={class:"bg-gray-50 px-6 py-4 border-t border-gray-200"},ns={key:0,class:"text-sm font-medium text-gray-900 mb-1"},ls={class:"text-xs text-gray-600"},is={class:"text-xs text-gray-500 mt-1"},Ve="localStorage",cs={__name:"GuestMapV2",props:{facilities:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]},polygons:{type:Array,default:()=>[]}},setup(V){const T=V,g=xt(),H=io(),{isSearching:te,showSearchResults:Z,showGuestModal:O,isGuestInfoComplete:N,showInstructions:A,isSavingFeedback:X,map:r,searchQuery:M,destinationMarker:z,routePolyline:S,routeInfo:G,privateRoutes:s,guestStep:x,selectedMarker:h,feedback:_,message:C,filteredLocations:L,selectedLocation:i,geoJsonLayers:R,navigationInstructions:$}=Qt(H),E=wt(),w=mo(),{addFacilityMarker:Y,displayPolygons:Q,markerTypeIcons:se,facilityMarkers:K,polygonLayers:U}=yo(),d=F({id:null,nickname:"",role:""}),ne=F(null),J=F("walking"),le=F(null),ve=F(null),Me=[{value:"walking",label:"Walking",icon:"üö∂",speed:5},{value:"riding",label:"Riding",icon:"üö¥",speed:15},{value:"driving",label:"Driving",icon:"üöó",speed:40}],he=F([]),kt=[{value:"student",label:"Student",icon:"üéì"},{value:"faculty",label:"Faculty",icon:"üë®‚Äçüè´"},{value:"visitor",label:"Visitor",icon:"üë§"}],ee=F([]),ke=F([]),ae=F({}),fe=F(!1),Xe=F(!1),He=F(null),me=F(null),$e=F(""),Je=F(!1),ie=F(""),Ze=F(!1),Ie=F(null),Pe=F(!1),Fe=F(!1),qe=F(!1),q=F(0),Ce=F(!1),Te=F("navigation"),Re=F(!1),ye=F([]),nt=()=>{const e=[];Array.isArray(T.facilities)&&T.facilities.forEach(t=>{const o=t?.marker?.feedbacks;Array.isArray(o)&&o.forEach(n=>{n&&e.push(n)})}),ke.value=e},lt=()=>{const e={};Array.isArray(T.facilities)&&T.facilities.forEach(t=>{!t||!t.id||(e[t.id]=Array.isArray(t.photos)?[...t.photos]:[])}),ae.value=e};nt(),lt();const _t=async e=>{if(e)try{const t=await ge.get(`/pub/facilities/${e}/photos`);ae.value={...ae.value,[e]:Array.isArray(t.data?.photos)?t.data.photos:[]}}catch(t){console.error("Error fetching facility photos:",t)}};Ae(()=>T.notes,e=>{ee.value=Array.isArray(e)?[...e]:[]},{deep:!0}),Ae(()=>T.facilities,()=>{nt(),lt()},{deep:!0});const Ee=ue(()=>i.value?.id??null),De=ue(()=>i.value?.marker_id??i.value?.marker?.id??null),Qe=ue(()=>{if(!Ee.value)return[];const e=ae.value[Ee.value]||[];return!Ce.value&&e.length>2?e.slice(0,2):e}),ce=ue(()=>Ee.value?ae.value[Ee.value]||[]:[]),Ne=ue(()=>{if(!Ee.value)return{displayed:0,total:0};const e=ae.value[Ee.value]||[];return{displayed:Qe.value.length,total:e.length}}),ze=ue(()=>De.value?ee.value.filter(e=>e.marker_id===De.value):[]),et=ue(()=>De.value?ke.value.filter(e=>e.marker_id===De.value):[]),St=ue(()=>!De.value||!d.value.id?!1:ze.value.some(e=>e.guest_id===d.value.id)),Lt=((e,t)=>{let o;return(...n)=>{clearTimeout(o),o=setTimeout(()=>e(...n),t)}})(async e=>{if(!(!e.trim()||!d.value.id))try{await ge.post("/search-logs",{guest_id:d.value.id,query:e.trim(),search_at:new Date().toISOString()}),console.log("Search logged successfully")}catch(t){console.error("Failed to log search:",t)}},500);Ae($,()=>{ve.value&&(ve.value.scrollTop=0)},{deep:!0}),Ae(M,e=>{e.length>0&&Lt(e),e.length>0?(te.value=!0,L.value=re.value.filter(t=>t.name&&t.name.toLowerCase().includes(e.toLowerCase())||t.department&&t.department.toLowerCase().includes(e.toLowerCase())||t.description&&t.description.toLowerCase().includes(e.toLowerCase())||t.floor_number&&t.floor_number.toLowerCase().includes(e.toLowerCase())||t.category&&t.category.toLowerCase().includes(e.toLowerCase())),Z.value=!0):(Z.value=!1,L.value=[]),te.value=!1});const it=()=>{ne.value=setInterval(()=>{const e=sessionStorage.getItem("guestInfo");if(e)try{const t=JSON.parse(e);t.expiresAt&&Date.now()>t.expiresAt&&(console.log("‚è±Ô∏è Session expired, reloading page..."),ct())}catch(t){console.error("Error checking session:",t),ct()}},6e4)},ct=()=>{sessionStorage.removeItem("guestInfo"),window.location.reload()},Mt=()=>{const e=sessionStorage.getItem("guestInfo");if(e)try{const t=JSON.parse(e);return t.expiresAt&&Date.now()>t.expiresAt?(console.log("‚è±Ô∏è Session expired, clearing stored data"),sessionStorage.removeItem("guestInfo"),!1):(d.value=t,N.value=!0,O.value=!1,it(),!0)}catch(t){console.error("Error parsing guest info:",t),sessionStorage.removeItem("guestInfo")}return!1},re=ue(()=>!T.facilities||!Array.isArray(T.facilities)?(console.warn("No facilities data"),[]):T.facilities.filter(e=>e&&e.marker&&e.marker.longitude!==null&&e.marker.latitude!==null&&!isNaN(parseFloat(e.marker.longitude))&&!isNaN(parseFloat(e.marker.latitude))).map(e=>{try{const t=e.marker?.type?.toLowerCase()||"default";return{id:e.id,marker_id:e.marker.id,name:e.name||"Unnamed Facility",lng:parseFloat(e.marker.longitude),lat:parseFloat(e.marker.latitude),department:e.marker?.type||"Unknown",markerType:t,category:e.category||"General",description:e.description||"",floor_number:e.floor_number?String(e.floor_number):"Not specified",status:e.status||"Not specified",hours:e.hours||"Not specified",icon:se[t]||se.default,marker:e.marker,photos:Array.isArray(e.photos)?e.photos:[],feedbacks:e.marker?.feedbacks||[]}}catch(t){return console.error("Error processing facility:",e,t),null}}).filter(e=>e!==null)),ut=()=>{if(!d.value.nickname.trim()){g.error("Please enter your nickname");return}x.value=2},Pt=()=>{x.value=1},Ct=async()=>{if(!d.value.nickname||!d.value.role){g.error("Please complete all steps");return}try{const t=(await ge.post("/guests",{name:d.value.nickname,role:d.value.role})).data;d.value.id=t.id;const o={...d.value,expiresAt:Date.now()+1440*60*1e3};sessionStorage.setItem("guestInfo",JSON.stringify(o)),N.value=!0,O.value=!1,g.success(`Welcome, ${d.value.nickname}!`),it(),r.value?w.userLocation.value?w.updateUserMarker(d.value,r.value,st):w.startTracking(d.value,r.value,st):await vt()}catch(e){console.error("Error saving guest info:",e),g.error(e.response?.data?.message||"Failed to save guest information")}},Et=e=>{const t=Me.find(l=>l.value===J.value),n=(t?t.speed:5)*1e3/3600,b=e/n,k=Math.ceil(b/60),m=new Date,f=new Date(m.getTime()+b*1e3);return{minutes:k,arrivalTime:f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}},Nt=(e,t)=>E.generateEnhancedInstructions(e,t),Ge=(e,{centerOnMap:t=!0}={})=>{if(!e)return;const o=i.value&&i.value.id===e.id;if(h.value=e,i.value=e,fe.value=!0,!o){_.value="",ie.value="",Pe.value=!1,je(),Ce.value=!1;const n=localStorage,b=`facility_notes_${e.id}`,k=n.getItem(b);if(k)try{const m=JSON.parse(k),f=Date.now(),l=m.filter(D=>!(D.expiresAt&&D.expiresAt<f));l.length!==m.length&&n.setItem(b,JSON.stringify(l));const c=new Set(l.map(D=>D.id)),I=ee.value.filter(D=>!c.has(D.id));ee.value=[...l,...I]}catch(m){console.warn("Error parsing stored notes:",m)}}if(e.id&&_t(e.id),t&&r.value)try{r.value.panTo([e.lat,e.lng],{animate:!0})}catch(n){console.warn("Failed to pan to location:",n)}},At=()=>{fe.value=!1},$t=()=>{if(!i.value||!r.value){g.error("Select a destination first");return}_e(j.latLng(i.value.lat,i.value.lng),i.value)},_e=async(e,t=null,o=null)=>{if(!w.userLocation.value){g.error("Waiting for GPS location...");return}if(t?(!i.value||i.value.id!==t.id||!fe.value)&&Ge(t,{centerOnMap:!1}):(fe.value=!1,i.value=null),S.value&&r.value){try{r.value.hasLayer(S.value)&&r.value.removeLayer(S.value)}catch(l){console.warn("Error removing route polyline:",l)}S.value=null}if(z.value&&r.value){try{r.value.hasLayer(z.value)&&r.value.removeLayer(z.value)}catch(l){console.warn("Error removing destination marker:",l)}z.value=null}r.value&&r.value.closePopup();const n={lat:w.userLocation.value.lat,lng:w.userLocation.value.lng},b={lat:e.lat,lng:e.lng};if(le.value={lat:n.lat,lng:n.lng},console.log("Calculating optimal route..."),s.value&&s.value.features){const l=E.findClickedLineString(b,s.value.features,30);if(l){console.log("User clicked on a campus path! Using hybrid route...");const c=l.feature.geometry.coordinates,I=l.point,D={lat:c[0][1],lng:c[0][0]},B=await E.getPublicRoute(n,D,J.value);let W=[];B&&B.length>0?W=[...B]:W=[n,D];for(let Le=0;Le<=I.index;Le++){const[Ye,qt]=c[Le];W.push({lat:qt,lng:Ye})}Se(W,"hybrid",!0,o),console.log("Hybrid route to campus path completed");return}}if(!s.value||!s.value.features||s.value.features.length===0){console.warn("No campus paths available, using public route only");const l=await E.getPublicRoute(n,b,J.value);l?Se(l,"public",!1,o):Se([n,b],"direct",!1,o);return}const k=E.buildCampusGraph(s.value.features);if(k.size===0){console.warn("Campus graph is empty, using public route only");const l=await E.getPublicRoute(n,b,J.value);l?Se(l,"public",!1,o):Se([n,b],"direct",!1,o);return}const m=[];try{const l=await E.getPublicRoute(n,b,J.value);if(l&&l.length>0){const c=E.calculateRouteDistance(l);m.push({type:"public",route:l,distance:c,isPrivate:!1}),console.log(`Public route: ${Math.round(c)}m`)}}catch(l){console.error("Public route error:",l)}try{const l=E.findNearestNode(n,k,100),c=E.findNearestNode(b,k,100);if(l&&c){console.log(`üîç Trying A* from ${l} to ${c}`);const I=E.findPathAStar(l,c,k);if(I&&I.length>0){const D=E.calculateRouteDistance(I);m.push({type:"private",route:I,distance:D,isPrivate:!0}),console.log(`Campus route: ${Math.round(D)}m`)}}}catch(l){console.error("Campus route error:",l)}try{const l=E.findCampusEntrances(k);if(l.length>0){const c=l.reduce((I,D)=>{const B=E.calculateDistance(b.lat,b.lng,D.lat,D.lng);return B<I.distance?{entrance:D,distance:B}:I},{entrance:null,distance:1/0});if(c.entrance&&c.distance<200){const I={lat:c.entrance.lat,lng:c.entrance.lng},D=await E.getPublicRoute(n,I,J.value);if(D&&D.length>0){const B=E.findNearestNode(b,k,100);if(B){const W=E.findPathAStar(c.entrance.id,B,k);if(W&&W.length>0){const Le=[...D,...W],Ye=E.calculateRouteDistance(Le);m.push({type:"hybrid",route:Le,distance:Ye,isPrivate:!0}),console.log(`Hybrid route: ${Math.round(Ye)}m`)}}}}}}catch(l){console.error("Hybrid route error:",l)}if(m.length===0){console.warn("All routing failed, using direct line"),Se([n,b],"direct",!1);return}const f=m.reduce((l,c)=>c.distance<l.distance?c:l);console.log(`Selected: ${f.type.toUpperCase()} route (${Math.round(f.distance)}m)`),Se(f.route,f.type,f.isPrivate)},Se=(e,t,o,n=null)=>{if(!r.value){console.warn("Cannot draw route: map not initialized");return}if(S.value){try{r.value.hasLayer(S.value)&&r.value.removeLayer(S.value)}catch(B){console.warn("Error removing old route polyline:",B)}S.value=null}if(z.value){try{r.value.hasLayer(z.value)&&r.value.removeLayer(z.value)}catch(B){console.warn("Error removing old destination marker:",B)}z.value=null}const b=e.map(B=>[B.lat,B.lng]),m=n||{public:"#4CAF50",private:"#FF6B6B",hybrid:"#2196F3",direct:"#9E9E9E"}[t]||"#9E9E9E";S.value=j.polyline(b,{color:m,weight:6,opacity:.8,smoothFactor:1}).addTo(r.value),Xe.value=!0;const f=E.calculateRouteDistance(e),l=f>1e3?`${(f/1e3).toFixed(2)} km`:`${Math.round(f)} m`,c=Et(f),I={public:"üü¢ Public Roads",private:"üî¥ Campus Path",hybrid:"üîµ Public ‚Üí Campus",direct:"‚ö™ Direct Line"},D=Me.find(B=>B.value===J.value);G.value=`${I[t]}
${D.icon} ${D.label}
üìè ${l}
‚è±Ô∏è ${c.minutes} min
üïê Arrive at ${c.arrivalTime}`,$.value=Nt(e,o),A.value=!0,console.log(`Generated ${$.value.length} navigation instructions`);try{S.value&&r.value.hasLayer(S.value)&&r.value.fitBounds(S.value.getBounds(),{padding:[50,50]})}catch(B){console.warn("Error fitting bounds:",B)}g.success(`Route via ${I[t]}`)},It=()=>{if(!S.value){g.error("Please create a route first");return}if(!i.value){g.error("No destination selected");return}const e=S.value.getLatLngs(),t=20,o=e.map(n=>({lat:n.lat,lng:n.lng}));if(o.length>t){const n=Math.floor(o.length/t);ye.value=[];for(let b=0;b<o.length;b+=n)ye.value.push(o[b]);ye.value[ye.value.length-1]!==o[o.length-1]&&ye.value.push(o[o.length-1])}else ye.value=o;console.log("üéØ Starting AR Navigation with",ye.value.length,"route points (sampled from",o.length,"total points)"),Re.value=!0},Ft=()=>{console.log("‚úÖ AR Navigation started"),g.success("AR Navigation activated! Point your camera around.")},Tt=()=>{console.log("üõë AR Navigation stopped"),Re.value=!1,g.info("Returned to map view")},Rt=()=>{console.log("üéâ Destination reached!"),g.success("üéâ You have arrived at your destination!"),setTimeout(()=>{Re.value=!1},3e3)},Dt=()=>{const e=localStorage,t=[],o=Date.now();for(let n=0;n<e.length;n++){const b=e.key(n);if(b&&b.startsWith("facility_notes_"))try{const k=e.getItem(b);if(k){const m=JSON.parse(k),f=m.filter(l=>!(l.expiresAt&&l.expiresAt<o));f.length!==m.length&&e.setItem(b,JSON.stringify(f)),t.push(...f)}}catch(k){console.warn(`Error parsing notes from ${b}:`,k)}}ee.value=t,console.log(`üìù Loaded ${t.length} notes from ${Ve}`)},zt=()=>{if(!r.value){g.error("Map not initialized");return}if(!w.userLocation.value){g.error("GPS location not available yet");return}const{lat:e,lng:t}=w.userLocation.value;r.value.flyTo([e,t],18,{animate:!0,duration:1.5}),g.success("Centered on your location"),w.userMarker.value&&setTimeout(()=>{w.userMarker.value.openPopup(),setTimeout(()=>w.userMarker.value.closePopup(),2e3)},1500)},tt=async e=>{try{const t=Ve==="localStorage"?localStorage:sessionStorage,o=ee.value.find(m=>m.id===e);if(!o)return;let n=!1;const b=re.value.find(m=>m.marker_id===o.marker_id);if(b){const m=`facility_notes_${b.id}`,f=t.getItem(m);if(f){let l=JSON.parse(f);const c=l.filter(I=>I.id!==e);c.length!==l.length&&(c.length===0?t.removeItem(m):t.setItem(m,JSON.stringify(c)),n=!0)}}if(!n)for(let m=0;m<t.length;m++){const f=t.key(m);if(!(!f||!f.startsWith("facility_notes_")))try{const l=t.getItem(f);if(!l)continue;let c=JSON.parse(l);const I=c.filter(D=>D.id!==e);if(I.length!==c.length){I.length===0?t.removeItem(f):t.setItem(f,JSON.stringify(I)),n=!0;break}}catch(l){console.warn("Error checking storage key for note deletion:",f,l)}}const k=he.value.findIndex(m=>m.noteId===e);if(k!==-1&&r.value){const m=he.value[k].marker;if(m)try{m.off(),r.value.hasLayer(m)&&r.value.removeLayer(m)}catch(f){console.warn("Error removing note marker:",f)}he.value.splice(k,1)}ee.value=ee.value.filter(m=>m.id!==e),n?g.success("Note deleted"):g.warning("Note removed from view but not found in storage")}catch(t){console.error("Error deleting note:",t)}},Gt=async()=>{if(!ie.value.trim()){g.error("Please enter a note before saving");return}if(!d.value.id){g.error("Guest information not found");return}if(!i.value){g.error("Select a destination to attach the note");return}Ze.value=!0;try{const e=Ve==="localStorage"?localStorage:sessionStorage,t=`facility_notes_${i.value.id}`,o=`${t}_expiration`,n=e.getItem(t);let b=n?JSON.parse(n):[];const k=Date.now();b=b.filter(c=>!(c.expiresAt&&c.expiresAt<k));const m=b.findIndex(c=>c.guest_id===d.value.id),f=k+1440*60*1e3,l={id:`${Ve}_${Date.now()}`,content:ie.value.trim(),marker_id:i.value.marker_id,guest_id:d.value.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),expiresAt:f,guest:{id:d.value.id,name:d.value.nickname}};m!==-1?b[m]=l:b.push(l),e.setItem(t,JSON.stringify(b)),ee.value=ee.value.filter(c=>!(c.marker_id===i.value.marker_id&&c.guest_id===d.value.id)),ee.value=[...ee.value,l],window.location.reload()}catch(e){console.error("Error saving note:",e),g.error("Failed to save note")}finally{Ze.value=!1}},jt=e=>{const t=e?.target?.files?.[0];t&&(me.value&&URL.revokeObjectURL(me.value),He.value=t,me.value=URL.createObjectURL(t),e?.target&&(e.target.value=""))},je=()=>{me.value&&URL.revokeObjectURL(me.value),He.value=null,me.value=null,$e.value="",Ie.value&&(Ie.value.value="")},Bt=()=>{const e=ze.value.find(t=>t.guest_id===d.value.id);e?ie.value=e.content:ie.value="",Pe.value=!0},Ot=async()=>{if(!i.value){g.error("Select a destination before uploading photos");return}if(!d.value.id){g.error("Guest information not found");return}if(!He.value){g.error("Choose a photo to upload");return}Je.value=!0;try{const e=new FormData;e.append("photo",He.value),e.append("guest_id",d.value.id),$e.value.trim()&&e.append("caption",$e.value.trim());const t=await ge.post(`/pub/facilities/${i.value.id}/photos`,e,{headers:{"Content-Type":"multipart/form-data"}}),o=t.data.photo,n=i.value.id;ae.value={...ae.value,[n]:[o,...ae.value[n]||[]]},g.success(t.data.message||"Photo uploaded successfully!"),je()}catch(e){console.error("Error uploading photo:",e),g.error("Failed to upload photo")}finally{Je.value=!1}},Ut=()=>{Ie.value&&Ie.value.click()},Be=e=>{if(!e)return"";try{return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Failed to format timestamp:",t),e}},ot=()=>{if(!r.value||!r.value._loaded||!Array.isArray(K.value)){console.warn("displayNotesOnMap: Map or markers not ready");return}if(!d.value||!d.value.id){console.warn("displayNotesOnMap: Guest info not available");return}if(be||r.value._animatingZoom||r.value._isZooming){console.warn("displayNotesOnMap: BLOCKED - Zoom in progress!");return}if(r.value._zoom!==r.value.getZoom()){console.warn("displayNotesOnMap: Zoom level mismatch, delaying..."),setTimeout(()=>ot(),300);return}he.value.forEach(e=>{if(e.marker&&r.value)try{e.marker.off(),r.value.hasLayer(e.marker)&&r.value.removeLayer(e.marker)}catch(t){console.warn("Error removing note marker:",t)}}),he.value=[],K.value.forEach((e,t)=>{const o=re.value[t];if(!o)return;const n=ee.value.find(b=>b.marker_id===o.marker_id&&b.guest_id===d.value.id);if(n)try{const b=l=>{const c=document.createElement("div");return c.textContent=l,c.innerHTML},k=`
          <div class="note-bubble-container" data-note-id="${n.id}" style="
            background: white !important;
            border: 2px solid #E5E7EB !important;
            border-radius: 12px !important;
            padding: 14px 16px !important;
            min-width: 220px !important;
            max-width: 300px !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15), 0 4px 10px rgba(0, 0, 0, 0.08) !important;
            position: relative !important;
            opacity: 1 !important;
            transform: translateY(-100%) !important;
            margin-bottom: 20px !important;
            pointer-events: auto !important;
          ">
            <div class="note-bubble-header" style="
              display: flex !important;
              align-items: flex-start !important;
              gap: 10px !important;
              margin-bottom: 10px !important;
              padding-bottom: 10px !important;
              border-bottom: 1px solid #F3F4F6 !important;
            ">
              <div class="note-bubble-icon" style="font-size: 20px !important; line-height: 1 !important; flex-shrink: 0 !important;">üí¨</div>
              <div class="note-bubble-meta" style="
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 3px !important;
              ">
                <span class="note-bubble-label" style="
                  font-size: 11px !important;
                  font-weight: 700 !important;
                  color: #6366F1 !important;
                  text-transform: uppercase !important;
                  letter-spacing: 0.8px !important;
                ">Your Note</span>
                <span class="note-bubble-time" style="
                  font-size: 10px !important;
                  color: #9CA3AF !important;
                  font-weight: 500 !important;
                ">${Be(n.created_at)}</span>
              </div>
              <button
                class="note-bubble-delete"
                title="Delete note"
                data-note-id="${n.id}"
                style="
                  background: #FEE2E2 !important;
                  border: none !important;
                  border-radius: 6px !important;
                  width: 24px !important;
                  height: 24px !important;
                  display: flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  cursor: pointer !important;
                  color: #EF4444 !important;
                  transition: all 0.2s ease !important;
                  flex-shrink: 0 !important;
                  padding: 0 !important;
                "
              >
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
            <div class="note-bubble-content" style="
              font-size: 14px !important;
              color: #1F2937 !important;
              line-height: 1.6 !important;
              word-wrap: break-word !important;
              font-weight: 400 !important;
              padding: 0 !important;
            ">${b(n.content)}</div>
            <div class="note-bubble-arrow" style="
              position: absolute !important;
              bottom: -10px !important;
              left: 50% !important;
              transform: translateX(-50%) !important;
              width: 0 !important;
              height: 0 !important;
              border-left: 12px solid transparent !important;
              border-right: 12px solid transparent !important;
              border-top: 12px solid white !important;
              filter: drop-shadow(0 3px 3px rgba(0, 0, 0, 0.1)) !important;
            "></div>
          </div>
        `,m=j.divIcon({className:"note-bubble-marker",html:k,iconSize:[280,"auto"],iconAnchor:[140,70]});if(!r.value||be||r.value._animatingZoom){console.warn(`Aborting note marker creation for ${o.name} - zoom in progress`);return}const f=j.marker([o.lat,o.lng],{icon:m,interactive:!0,zIndexOffset:1e3,bubblingMouseEvents:!0});try{f.addTo(r.value)}catch(l){console.error("Failed to add note marker to map:",l);return}he.value.push({noteId:n.id,marker:f,facilityMarkerId:o.marker_id}),setTimeout(()=>{const l=document.querySelector(`.note-bubble-delete[data-note-id="${n.id}"]`);l&&l.addEventListener("click",c=>{c.stopPropagation(),tt(n.id)})},150)}catch(b){console.error(`‚ùå Error creating note marker for ${o.name}:`,b)}}),console.log(`üìù Created ${he.value.length} note bubble markers`)};let at=null,be=!1;const rt=()=>{if(be){console.warn("debouncedDisplayNotes: Skipping due to zoom in progress");return}at&&clearTimeout(at),at=setTimeout(()=>{!be&&r.value&&!r.value._animatingZoom&&ot()},250)};Ae(ee,()=>{r.value&&!be&&rt()},{deep:!0}),Ae(()=>T.polygons,()=>{r.value&&Q(T.polygons,r.value)},{deep:!0,immediate:!1});const dt=async()=>{try{const e=await ge.get("/routes/export/geojson-pub",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});s.value=e.data,r.value&&Vt(),console.log("Loaded routes from database:",s.value)}catch(e){console.error("Error loading routes from database:",e),g.error("Failed to load campus paths")}},Vt=()=>{if(!r.value||!s.value||!s.value.features){console.warn("Cannot refresh private routes: Map or data not ready");return}R.value.forEach(e=>{if(r.value&&r.value.hasLayer&&r.value.hasLayer(e))try{r.value.removeLayer(e)}catch(t){console.warn("Error removing route layer:",t)}}),R.value=[],s.value.features.forEach(e=>{if(e.geometry&&e.geometry.type==="LineString"){const t=e.properties?.color||"#FF6B6B",o=j.geoJSON(e,{style:{color:t,weight:6,opacity:.9,dashArray:"10, 5",lineCap:"round",lineJoin:"round"}}).addTo(r.value);o.on("click",n=>{j.DomEvent.stopPropagation(n),_e(n.latlng,null,e.properties?.color)}),R.value.push(o)}}),console.log(`Added ${s.value.features.length} campus path layers`)},pt=async()=>{try{const e=await ge.get("/",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(e.data&&e.data.props&&e.data.props.facilities){if(H.facilities=e.data.props.facilities,K.value.forEach(t=>{if(r.value&&r.value.hasLayer&&r.value.hasLayer(t))try{r.value.removeLayer(t)}catch(o){console.warn("Error removing marker:",o)}}),K.value=[],re.value.length>0)for(let t=0;t<re.value.length;t++){const o=re.value[t],n=Y(o,r.value);if(n){typeof n.unbindPopup=="function"&&n.unbindPopup();let b=o.marker?.label||o.department||"Loading location...",k=`
              <div style="padding: 8px; min-width: 200px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                  <span style="font-size: 20px;">${o.icon}</span>
                  <strong style="font-size: 14px; color: #1f2937;">${o.name}</strong>
                </div>
                <p style="font-size: 12px; color: #6b7280; margin: 0;">${b}</p>
                <button
                  onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${o.id} }))"
                  style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                  onmouseover="this.style.background='#2563eb'"
                  onmouseout="this.style.background='#3b82f6'"
                >
                  View Details
                </button>
              </div>
            `;n.bindPopup(k,{closeButton:!1,className:"facility-popup",offset:[0,-15]}),setTimeout(()=>{console.log(`Geocoding ${o.name} at [${o.lat}, ${o.lng}]`),gt(o.lat,o.lng).then(m=>{m?(b=m,k=`
                      <div style="padding: 8px; min-width: 200px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                          <span style="font-size: 20px;">${o.icon}</span>
                          <strong style="font-size: 14px; color: #1f2937;">${o.name}</strong>
                        </div>
                        <p style="font-size: 12px; color: #6b7280; margin: 0;">${b}</p>
                        <button
                          onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${o.id} }))"
                          style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                          onmouseover="this.style.background='#2563eb'"
                          onmouseout="this.style.background='#3b82f6'"
                        >
                          View Details
                        </button>
                      </div>
                    `,n.setPopupContent(k)):console.warn(`No geocoded address for ${o.name}, keeping fallback`)}).catch(m=>{console.error(`Geocoding failed for ${o.name}:`,m)})},t*1e3),n.on("mouseover",function(){this.openPopup()}),n.on("popupopen",function(){const f=this.getPopup().getElement();f&&(f.addEventListener("mouseenter",()=>{n.openPopup()}),f.addEventListener("mouseleave",()=>{n.closePopup()}))}),n.on("mouseout",function(){const m=this;setTimeout(()=>{const f=m.getPopup();f&&f.getElement()&&(f.getElement().matches(":hover")||m.closePopup())},100)}),n.on("click",()=>{Ge(o)})}}console.log("‚úì Facilities loaded and markers refreshed:",re.value.length)}}catch(e){console.error("Error loading facilities:",e),g.error("Failed to load facilities")}},Ht=async()=>{try{const e=await ge.get("/facilities/polygons",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});e.data&&(U.value.forEach(t=>{if(r.value&&r.value.hasLayer&&r.value.hasLayer(t))try{r.value.removeLayer(t)}catch(o){console.warn("Error removing polygon:",o)}}),U.value=[],Q(e.data,r.value),console.log("‚úì Polygons loaded and refreshed"))}catch(e){console.error("Error loading polygons:",e),g.error("Failed to load polygons")}},st=e=>{if(i.value&&Xe.value)if(le.value){const t=E.calculateDistance(le.value.lat,le.value.lng,e.lat,e.lng);t>10?(console.log(`User moved ${Math.round(t)}m since last route calculation, updating route...`),le.value={lat:e.lat,lng:e.lng},g.info("Updating route from new position...",{timeout:2e3}),_e(j.latLng(i.value.lat,i.value.lng),i.value)):console.log(`User moved ${Math.round(t)}m (< 10m threshold, keeping current route)`)}else S.value&&(console.log("Initial GPS sync for existing route, recalculating..."),le.value={lat:e.lat,lng:e.lng},_e(j.latLng(i.value.lat,i.value.lng),i.value))},gt=async(e,t)=>{try{const o=await ge.get("/api/geocode/reverse",{params:{lat:e,lng:t}});return o.data&&o.data.success?o.data.address:(console.warn("No address data in response"),null)}catch(o){return console.error("Reverse geocoding error:",o),null}},vt=async()=>{try{await dt(),Dt();const e=j.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}),t=j.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"});r.value=j.map("map",{center:[8.1695,126.001838],zoom:17,layers:[e],zoomControl:!0}),Te.value="navigation";const o={navigation:{layer:e},satellite:{layer:t}},n=k=>{if(!o[k]||Te.value===k)return;const m=o[Te.value]?.layer;m&&r.value.hasLayer(m)&&r.value.removeLayer(m),o[k].layer.addTo(r.value),Te.value=k},b=j.Control.extend({options:{position:"bottomright"},onAdd:()=>{const k=j.DomUtil.create("div","leaflet-control guest-map-controls");k.innerHTML=`
          <button type="button" class="guest-control-button guest-control-button__locate" data-action="locate" title="Jump to my location">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3" />
              <path d="M12 5V3" />
              <path d="M12 21v-2" />
              <path d="M5 12H3" />
              <path d="M21 12h-2" />
              <path d="M19.071 4.929l-1.414 1.414" />
              <path d="M6.343 17.657l-1.414 1.414" />
              <path d="M4.929 4.929l1.414 1.414" />
              <path d="M17.657 17.657l1.414 1.414" />
            </svg>
          </button>
          <div class="guest-base-toggle">
            <button type="button" class="guest-control-button" data-layer="navigation" title="Navigation view">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 20l-6-2V6l6 2 6-2 6 2v12l-6-2-6 2z" />
                <path d="M9 8v12" />
                <path d="M15 6v12" />
              </svg>
            </button>
            <button type="button" class="guest-control-button" data-layer="satellite" title="Satellite view">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 4h6l10 10-6 6L4 10V4z" />
                <path d="M2 12l4-4" />
                <path d="M12 22l4-4" />
                <path d="M14 10l-4 4" />
              </svg>
            </button>
          </div>
        `;const m=k.querySelector('[data-action="locate"]'),f=k.querySelectorAll("[data-layer]"),l=()=>{f.forEach(c=>{c.classList.toggle("is-active",c.dataset.layer===Te.value)})};return j.DomEvent.on(m,"click",c=>{j.DomEvent.stopPropagation(c),j.DomEvent.preventDefault(c),zt()}),f.forEach(c=>{j.DomEvent.on(c,"click",I=>{j.DomEvent.stopPropagation(I),j.DomEvent.preventDefault(I);const D=c.dataset.layer;n(D),l()})}),l(),j.DomEvent.disableClickPropagation(k),j.DomEvent.disableScrollPropagation(k),k}});r.value.addControl(new b),r.value.whenReady(()=>{if(re.value.length>0){console.log(`Adding ${re.value.length} facility markers`);for(let f=0;f<re.value.length;f++){const l=re.value[f],c=Y(l,r.value);if(c){typeof c.unbindPopup=="function"&&c.unbindPopup();let I=l.marker?.label||l.department||"Loading location...",D=`
              <div style="padding: 8px; min-width: 200px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                  <span style="font-size: 20px;">${l.icon}</span>
                  <strong style="font-size: 14px; color: #1f2937;">${l.name}</strong>
                </div>
                <p style="font-size: 12px; color: #6b7280; margin: 0;">${I}</p>
                <button
                  onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${l.id} }))"
                  style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                  onmouseover="this.style.background='#2563eb'"
                  onmouseout="this.style.background='#3b82f6'"
                >
                  View Details
                </button>
              </div>
            `;c.bindPopup(D,{closeButton:!1,className:"facility-popup",offset:[0,-15]}),setTimeout(()=>{gt(l.lat,l.lng).then(B=>{B&&(I=B,D=`
                      <div style="padding: 8px; min-width: 200px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                          <span style="font-size: 20px;">${l.icon}</span>
                          <strong style="font-size: 14px; color: #1f2937;">${l.name}</strong>
                        </div>
                        <p style="font-size: 12px; color: #6b7280; margin: 0;">${I}</p>
                        <button
                          onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${l.id} }))"
                          style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                          onmouseover="this.style.background='#2563eb'"
                          onmouseout="this.style.background='#3b82f6'"
                        >
                          View Details
                        </button>
                      </div>
                    `,c.setPopupContent(D))}).catch(B=>{console.error(`Geocoding failed for ${l.name}:`,B)})},f*1e3),c.on("mouseover",function(){this.openPopup()}),c.on("popupopen",function(){const W=this.getPopup().getElement();W&&(W.addEventListener("mouseenter",()=>{c.openPopup()}),W.addEventListener("mouseleave",()=>{c.closePopup()}))}),c.on("mouseout",function(){const B=this;setTimeout(()=>{const W=B.getPopup();W&&W.getElement()&&(W.getElement().matches(":hover")||B.closePopup())},100)}),c.on("click",()=>{Ge(l)})}}}setTimeout(()=>{ot()},300),T.polygons&&T.polygons.length>0&&Q(T.polygons,r.value),s.value&&s.value.features&&s.value.features.forEach(f=>{if(f.geometry&&f.geometry.type==="LineString"){const l=f.properties?.color||"#FF6B6B",c=j.geoJSON(f,{style:{color:l,weight:6,opacity:.9,dashArray:"10, 5",lineCap:"round",lineJoin:"round"}}).addTo(r.value);c.on("click",I=>{j.DomEvent.stopPropagation(I),_e(I.latlng,null,f.properties?.color)}),R.value.push(c)}}),r.value.on("click",f=>{_e(f.latlng)});let k=!1;r.value.on("zoomstart",()=>{be=!0,r.value._isZooming=!0}),r.value.on("zoomend",()=>{setTimeout(()=>{be=!1,r.value._isZooming=!1,k&&(k=!1,rt())},100)});const m=rt;window.addEventListener("notesPending",()=>{be&&(k=!0)}),setTimeout(()=>{w.startTracking(d.value,r.value,st)},500)})}catch(e){console.error("Error initializing map:",e),g.error("Failed to initialize map. Please refresh the page.")}},Jt=e=>{Ge(e),M.value=e.name,Z.value=!1,_e(j.latLng(e.lat,e.lng),e),console.log(`Routing to ${e.name}`)},ht=()=>{if(M.value="",i.value=null,h.value=null,Z.value=!1,le.value=null,Xe.value=!1,fe.value=!1,ie.value="",Pe.value=!1,_.value="",je(),S.value&&r.value){try{r.value.hasLayer(S.value)&&r.value.removeLayer(S.value)}catch(e){console.warn("Error removing route polyline:",e)}S.value=null}if(z.value&&r.value){try{r.value.hasLayer(z.value)&&r.value.removeLayer(z.value)}catch(e){console.warn("Error removing destination marker:",e)}z.value=null}G.value=null,A.value=!1,console.log("Route cleared")},Zt=async()=>{if(!_.value.trim()){g.error("Please enter your feedback");return}if(!d.value.id){g.error("Guest information not found");return}if(!i.value){g.error("Select a destination before sending feedback");return}X.value=!0;try{const e=await ge.post("/create/feedback",{guest_id:d.value.id,marker_id:i.value.marker_id,message:_.value.trim()}),t={...e.data.feedback,message:_.value.trim(),marker_id:i.value.marker_id,guest:{id:d.value.id,name:d.value.nickname}};ke.value=[...ke.value,t],C.value=e.data.message,g.success(C.value||"Feedback saved successfully!"),_.value=""}catch(e){console.error("Error saving feedback:",e),g.error("Failed to save feedback")}finally{X.value=!1}},Yt=e=>{q.value=e,qe.value=!0},ft=()=>{qe.value=!1},Kt=()=>{q.value<Qe.value.length-1&&q.value++},Wt=()=>{q.value>0&&q.value--},Xt=Mt();return eo(()=>{Xt&&(vt(),console.log(`Welcome back, ${d.value.nickname}!`)),window.addEventListener("open-facility-panel",e=>{const t=e.detail,o=re.value.find(n=>n.id===t);o&&Ge(o)}),window.addEventListener("delete-note",e=>{const t=e.detail;confirm("Are you sure you want to delete this note?")&&tt(t)}),window.Echo.channel("main-channel").listen(".MainEvent",e=>{if(e.type==="route"&&(dt(),console.log("Route event:",e.action)),e.type==="facility"&&(pt(),console.log("Facility event:",e.action)),e.type==="marker"&&(pt(),console.log("Marker event:",e.action)),e.type==="polygon"&&(Ht(),console.log("Polygon event:",e.action)),e.type==="photo"&&e.action==="create"&&e.data){const t=e.data?.facility_id;if(t){const o=ae.value[t]||[];o.some(b=>b.id===e.data.id)||(ae.value={...ae.value,[t]:[e.data,...o]})}}e.type==="feedback"&&e.action==="create"&&e.data&&(ke.value.some(o=>o.id===e.data.id)||(ke.value=[...ke.value,e.data]))})}),to(()=>{if(w.stopTracking(r.value),ne.value&&clearInterval(ne.value),je(),r.value)try{S.value&&r.value.hasLayer(S.value)&&r.value.removeLayer(S.value),z.value&&r.value.hasLayer(z.value)&&r.value.removeLayer(z.value),R.value.forEach(e=>{r.value.hasLayer(e)&&r.value.removeLayer(e)}),he.value.forEach(e=>{e.marker&&r.value.hasLayer(e.marker)&&r.value.removeLayer(e.marker)})}catch(e){console.warn("Error during cleanup:",e)}console.log("Component unmounted, cleanup complete")}),(e,t)=>(u(),p(de,null,[a("div",bo,[oe(ro,{name:"details-panel"},{default:ao(()=>[v(N)&&fe.value&&v(i)?(u(),p("aside",xo,[t[24]||(t[24]=a("div",{class:"md:hidden flex justify-center pt-2 pb-1"},[a("div",{class:"w-12 h-1 bg-gray-300 rounded-full"})],-1)),a("div",wo,[t[14]||(t[14]=a("div",{class:"absolute top-0 left-0 right-0 h-1 bg-green-900/10"},null,-1)),a("div",ko,[a("div",_o,[a("div",So,[a("div",Lo,[a("div",Mo,y(v(i).icon),1),a("div",Po,[a("h2",Co,y(v(i).name),1),a("div",Eo,[a("span",No,y(v(i).category),1),v(i).department?(u(),p("span",Ao,y(v(i).department),1)):P("",!0)])])]),a("div",$o,[v(i).marker?.label?(u(),p("div",Io,[oe(v(po),{class:"w-3.5 h-3.5 text-gray-400 flex-shrink-0"}),a("span",Fo," Location: "+y(v(i).marker.label??"Not specified"),1)])):P("",!0),v(i).marker?.floor||v(i).floor_number?(u(),p("div",To,[oe(v(go),{class:"w-3.5 h-3.5 text-gray-400 flex-shrink-0"}),a("span",Ro," Floor:"+y(v(i).floor_number??"Not specified"),1)])):P("",!0),v(i).hours?(u(),p("div",Do,[oe(v(vo),{class:"w-3.5 h-3.5 text-green-600 flex-shrink-0 mt-0.5"}),a("span",zo," Hours: "+y(v(i).hours??"Operating hours not specified"),1)])):P("",!0)])]),a("button",{onClick:At,class:"flex-shrink-0 -mt-1 -mr-1 p-1.5 text-gray-400 hover:bg-gray-100 hover:text-gray-600 rounded-lg transition-colors"},[oe(v(We),{class:"h-5 w-5"})])])])]),a("div",Go,[a("section",jo,[v(i).description?(u(),p("p",Bo,y(v(i).description),1)):P("",!0),a("div",Oo,[a("button",{type:"button",onClick:$t,class:"inline-flex flex-1 items-center justify-center gap-2 rounded-lg bg-green-900 px-3 py-2 text-sm font-semibold text-white transition hover:bg-green-800"},[oe(v(ho),{class:"h-5 w-5"}),t[15]||(t[15]=Ke(" Start Navigation ",-1))]),Re.value?P("",!0):(u(),p("button",{key:0,type:"button",onClick:It,disabled:!v(S),class:xe(["inline-flex flex-1 items-center justify-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition shadow-lg",v(S)?"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 cursor-pointer":"bg-gray-400 cursor-not-allowed opacity-60"]),title:v(S)?"Switch to AR camera view":"Create a route first by clicking Start Navigation"}," üì± AR Navigation ",10,Uo)),v(S)?(u(),p("button",{key:1,type:"button",onClick:ht,class:"inline-flex items-center justify-center gap-2 rounded-lg border border-gray-300 px-3 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-100"}," ‚úñ Clear ")):P("",!0)]),v(G)?(u(),p("div",Vo,[t[16]||(t[16]=a("div",{class:"border-b border-gray-200 bg-gray-100 px-3 py-2"},[a("h3",{class:"text-xs font-semibold text-gray-800"},"Route Info")],-1)),a("p",Ho,y(v(G)),1)])):P("",!0),v(A)&&v($).length?(u(),p("div",Jo,[t[17]||(t[17]=a("div",{class:"border-b border-gray-200 bg-gray-100 px-3 py-2"},[a("h3",{class:"text-xs font-semibold text-gray-800"},"Navigation Steps")],-1)),a("div",{class:"max-h-60 overflow-y-auto",ref_key:"navigationInstructionsContainer",ref:ve},[(u(!0),p(de,null,we(v($),(o,n)=>(u(),p("div",{key:n,class:"flex gap-3 px-3 py-3 border-b border-gray-100 last:border-b-0 hover:bg-gray-50"},[a("span",Zo,y(o.icon),1),a("div",Yo,[a("p",Ko,y(o.text),1),a("p",Wo,y(o.distance),1)])]))),128))],512)])):P("",!0)]),a("section",Xo,[a("div",qo,[t[18]||(t[18]=a("h3",{class:"text-sm font-semibold text-gray-800"},"Photos",-1)),a("span",Qo,y(Ne.value.total)+" total",1)]),a("div",ea,[a("div",ta,[a("input",{ref_key:"photoInput",ref:Ie,type:"file",accept:"image/*",class:"hidden",onChange:jt},null,544),me.value?(u(),p("div",aa,[a("img",{src:me.value,alt:"Photo preview",class:"mx-auto max-h-40 rounded-md object-cover shadow-sm"},null,8,ra),Oe(a("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>$e.value=o),type:"text",maxlength:"255",placeholder:"Add a short caption (optional)",class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white"},null,512),[[Ue,$e.value]]),a("div",sa,[a("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 transition",onClick:je}," Cancel "),a("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:Je.value,onClick:Ot},y(Je.value?"Uploading...":"Save Photo"),9,na)])])):(u(),p("div",oa,[t[19]||(t[19]=a("p",{class:"text-sm text-gray-600"},"üì∏ Click to upload a photo",-1)),a("button",{type:"button",class:"inline-flex items-center justify-center rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white transition hover:bg-green-800",onClick:Ut}," Choose Photo ")]))]),Ne.value.total>0?(u(),p("div",la,[a("div",ia,[(u(!0),p(de,null,we(Qe.value,(o,n)=>(u(),p("article",{key:o.id,onClick:b=>Yt(n),class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm cursor-pointer transition hover:shadow-md hover:border-gray-300"},[a("img",{src:o.url,alt:o.caption||v(i).name,class:"h-28 w-full object-cover"},null,8,ua),a("div",da,[a("p",pa,y(o.caption||"Shared photo"),1),a("p",ga,y(o.guest?.name||"Guest")+" ‚Ä¢ "+y(Be(o.created_at)),1)])],8,ca))),128))]),Ne.value.total>2&&!Ce.value?(u(),p("button",{key:0,onClick:t[1]||(t[1]=o=>Ce.value=!0),class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-100 hover:border-gray-400"}," + "+y(Ne.value.total-2)+" More Photo"+y(Ne.value.total-2>1?"s":""),1)):P("",!0),Ce.value&&Ne.value.total>2?(u(),p("button",{key:1,onClick:t[2]||(t[2]=o=>Ce.value=!1),class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-100 hover:border-gray-400"}," Show Less ")):P("",!0)])):(u(),p("p",va,"Be the first to share a photo for this place."))])]),a("section",ha,[a("div",fa,[t[20]||(t[20]=a("h3",{class:"text-sm font-semibold text-gray-800"},"Notes",-1)),a("span",ma,y(ze.value.length)+" total",1)]),a("div",ya,[a("p",null,"You can add one note that will appear on the map. It expires after 24 hours and is stored in your browser ("+y(Ve==="localStorage"?"persists across sessions":"session only")+").",1),t[21]||(t[21]=a("p",{class:"font-semibold text-green-700"},"Notes appear as purple bubbles above markers. Click the ‚úï button to delete!",-1))]),Pe.value?(u(),p("div",ba,[Oe(a("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>ie.value=o),rows:"3",maxlength:"500",placeholder:"Share a quick note or tip about this spot...",class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white",autofocus:"",onKeydown:t[4]||(t[4]=mt(pe(()=>{},["prevent"]),["enter"]))},null,544),[[Ue,ie.value]]),a("div",xa,[a("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-100 transition",onClick:t[5]||(t[5]=pe(o=>Pe.value=!1,["prevent"]))}," Cancel "),a("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:Ze.value||!ie.value.trim(),onClick:pe(Gt,["prevent"])},y(Ze.value?"Saving...":"Save Note"),9,wa)])])):P("",!0),Pe.value?P("",!0):(u(),p("div",ka,[a("button",{type:"button",class:"w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:border-gray-400 hover:bg-gray-100",onClick:pe(Bt,["prevent"])},y(St.value?"‚úèÔ∏è Edit Your Note":"+ Add Note"),1)])),ze.value.length?(u(),p("div",_a,[(u(!0),p(de,null,we(ze.value,o=>(u(),p("article",{key:o.id,class:xe(["rounded-lg p-3 shadow-sm transition",o.guest_id===d.value.id?"ml-8 bg-green-100 border-l-4 border-green-700":"mr-8 bg-gray-100 border-l-4 border-gray-400"])},[a("div",Sa,[a("div",null,[a("p",La,[Ke(y(o.guest?.name||"Guest")+" ",1),o.guest_id===d.value.id?(u(),p("span",Ma," (You)")):P("",!0)]),a("p",Pa,y(Be(o.created_at)),1)]),o.guest_id===d.value.id?(u(),p("button",{key:0,type:"button",class:"rounded-md p-1 text-gray-400 transition hover:bg-gray-200 hover:text-red-500",onClick:pe(n=>tt(o.id),["prevent"]),title:"Delete note"},[oe(v(We),{class:"h-4 w-4"})],8,Ca)):P("",!0)]),a("p",Ea,y(o.content),1)],2))),128))])):(u(),p("p",Na,"No notes yet. Be the first to share!"))]),a("section",Aa,[a("div",$a,[t[22]||(t[22]=a("h3",{class:"text-sm font-semibold text-gray-800"},"Feedback",-1)),a("span",Ia,y(et.value.length)+" total",1)]),Fe.value?(u(),p("div",Fa,[Oe(a("textarea",{"onUpdate:modelValue":t[6]||(t[6]=o=>yt(_)?_.value=o:null),rows:"3",maxlength:"500",placeholder:"How was your experience here?",class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white",autofocus:""},null,512),[[Ue,v(_)]]),a("div",Ta,[a("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-100 transition",onClick:t[7]||(t[7]=pe(o=>Fe.value=!1,["prevent"]))}," Cancel "),a("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:v(X)||!v(_).trim(),onClick:pe(Zt,["prevent"])},y(v(X)?"Sending...":"Submit Feedback"),9,Ra)])])):P("",!0),Fe.value?P("",!0):(u(),p("div",Da,[a("button",{type:"button",class:"w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:border-gray-400 hover:bg-gray-100",onClick:t[8]||(t[8]=pe(o=>Fe.value=!Fe.value,["prevent"]))}," + Add Feedback ")])),et.value.length?(u(),p("div",za,[t[23]||(t[23]=a("h4",{class:"text-xs font-semibold text-gray-600 uppercase tracking-wide"},"Recent Feedback",-1)),a("div",Ga,[(u(!0),p(de,null,we(et.value,o=>(u(),p("article",{key:o.id,class:"rounded-lg border border-gray-200 bg-gray-50 px-3 py-3 shadow-sm"},[a("div",ja,[a("p",Ba,y(o.guest?.name||"Guest"),1),a("p",Oa,y(Be(o.created_at)),1)]),a("p",Ua,y(o.message),1)]))),128))])])):(u(),p("p",Va,"No feedback yet. Share your thoughts!"))])])])):P("",!0)]),_:1}),a("div",Ha,[a("div",{id:"map",class:xe(["h-full w-full transition-all duration-300",v(N)?"":"blur-sm pointer-events-none"])},null,2),v(N)?(u(),p("div",Ja,[a("div",Za,[a("div",Ya,[a("div",Ka,[oe(v(bt),{class:"h-4 w-4 text-gray-400"})]),Oe(a("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>yt(M)?M.value=o:null),type:"text",placeholder:"Search facilities by name, category, or floor...",class:"w-full border-0 py-3 pl-10 pr-10 text-sm text-gray-900 placeholder:text-gray-400 focus:ring-0 focus:outline-none bg-gray-50"},null,512),[[Ue,v(M)]]),v(M)?(u(),p("button",{key:0,onClick:ht,class:"absolute inset-y-0 right-0 flex items-center pr-3.5 transition-colors","aria-label":"Clear search"},[oe(v(We),{class:"h-4 w-4 text-gray-400 hover:text-gray-600"})])):P("",!0)]),v(Z)?(u(),p("div",Wa,[v(te)?(u(),p("div",Xa,[...t[25]||(t[25]=[a("div",{class:"inline-block h-5 w-5 animate-spin rounded-full border-2 border-gray-200 border-t-gray-600"},null,-1),a("p",{class:"mt-2.5 text-xs text-gray-500 font-medium"},"Searching facilities...",-1)])])):v(L).length===0?(u(),p("div",qa,[a("div",Qa,[oe(v(bt),{class:"h-5 w-5 text-gray-400"})]),t[26]||(t[26]=a("p",{class:"mt-3 text-xs font-semibold text-gray-900"},"No results found",-1)),t[27]||(t[27]=a("p",{class:"mt-1 text-xs text-gray-500"},"Try adjusting your search criteria",-1))])):(u(),p("div",er,[a("div",tr,[a("p",or,y(v(L).length)+" "+y(v(L).length===1?"Facility":"Facilities")+" Found ",1)]),a("div",ar,[(u(!0),p(de,null,we(v(L),o=>(u(),p("button",{key:o.id,onClick:n=>Jt(o),class:"flex w-full items-start gap-3 px-4 py-3 text-left transition-all hover:bg-gray-50 group"},[a("div",sr,[a("span",nr,y(o.icon),1)]),a("div",lr,[a("div",ir,[a("h3",cr,y(o.name),1),a("span",ur," Floor: "+y(o.floor_number??"Not specified"),1)]),a("div",dr,[a("span",pr,y(o.markerType??"Not specified"),1),a("span",gr,y(o.category??"Not specified"),1)]),o.description?(u(),p("p",vr,y(o.description??"No description available"),1)):P("",!0),o.capacity||o.amenities||o.status||o.hours?(u(),p("div",hr,[o.capacity?(u(),p("div",fr,[t[29]||(t[29]=a("svg",{class:"w-3 h-3 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})],-1)),a("span",mr,[a("span",yr,y(o.capacity),1),t[28]||(t[28]=Ke(" capacity ",-1))])])):P("",!0),o.amenities?(u(),p("div",br,[t[31]||(t[31]=a("svg",{class:"w-3 h-3 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),a("span",xr,[a("span",wr,y(o.amenities.length),1),t[30]||(t[30]=Ke(" amenities ",-1))])])):P("",!0),o.status?(u(),p("div",kr,[a("span",{class:xe(["w-2 h-2 rounded-full flex-shrink-0",o.status==="available"?"bg-green-500":o.status==="occupied"?"bg-red-500":"bg-gray-400"])},null,2),a("span",_r,"Status: "+y(o.status),1)])):P("",!0),o.hours?(u(),p("div",Sr,[t[32]||(t[32]=a("svg",{class:"w-3 h-3 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),a("span",Lr,"Hours: "+y(o.hours),1)])):P("",!0)])):P("",!0)]),t[33]||(t[33]=a("div",{class:"flex-shrink-0 mt-1.5"},[a("svg",{class:"w-4 h-4 text-gray-300 group-hover:text-green-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))],8,rr))),128))])]))])):P("",!0)])])):P("",!0),v(N)?(u(),p("div",Mr,[a("div",Pr,[(u(),p(de,null,we(Me,o=>a("button",{key:o.value,onClick:n=>J.value=o.value,class:xe(["min-w-[44px] rounded-md px-2.5 py-2 text-xs font-medium transition sm:px-3 sm:text-sm",J.value===o.value?"bg-green-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),title:o.label},[a("span",Er,y(o.icon),1),a("span",Nr,y(o.label),1)],10,Cr)),64))])])):P("",!0),v(N)?(u(),p("div",Ar,[a("div",$r,[oe(v(fo),{class:"h-5 w-5 text-green-900"}),a("div",Ir,[a("p",Fr,y(d.value.nickname),1),a("p",Tr,y(d.value.role),1)])])])):P("",!0),v(N)&&v(G)&&!fe.value?(u(),p("div",Rr,[a("div",Dr,[t[34]||(t[34]=a("h3",{class:"text-xs font-semibold text-white"},"Route Info",-1)),a("button",{onClick:t[10]||(t[10]=o=>G.value=null),class:"flex h-5 w-5 items-center justify-center rounded text-gray-400 transition hover:text-white"}," √ó ")]),a("p",zr,y(v(G)),1)])):P("",!0),v(A)&&!fe.value?(u(),p("div",Gr,[a("div",jr,[t[35]||(t[35]=a("h3",{class:"text-xs font-semibold text-white"},"Navigation",-1)),a("button",{onClick:t[11]||(t[11]=o=>A.value=!1),class:"flex h-5 w-5 items-center justify-center rounded text-gray-400 transition hover:text-white"}," √ó ")]),a("div",{ref_key:"navigationInstructionsContainer",ref:ve,class:"overflow-y-auto"},[(u(!0),p(de,null,we(v($),(o,n)=>(u(),p("div",{key:n,class:"flex items-start gap-2 border-b border-gray-100 px-3 py-2 text-xs last:border-b-0"},[a("span",Br,y(o.icon),1),a("div",Or,[a("p",Ur,y(o.text),1),a("p",Vr,y(o.distance),1)])]))),128))],512)])):P("",!0)]),v(O)?(u(),p("div",Hr,[a("div",Jr,[v(x)===1?(u(),p("div",Zr,[t[36]||(t[36]=so('<div class="mb-6 text-center sm:mb-8" data-v-536926b5><div class="flex items-center justify-center gap-3 mb-4" data-v-536926b5><div class="h-12 w-12 bg-green-900 rounded-full flex items-center justify-center p-1.5 shadow-md" data-v-536926b5><img src="'+no+'" alt="ASSCAT Logo" class="h-full w-full object-contain" data-v-536926b5></div><div class="flex flex-col items-start" data-v-536926b5><span class="text-lg font-bold text-green-900" data-v-536926b5>ASSCAT</span><span class="text-xs font-medium text-gray-600" data-v-536926b5>Campus Navigator</span></div></div><h2 class="mb-2 text-xl font-bold text-gray-900 sm:text-2xl" data-v-536926b5>Welcome to ASSCAT Campus Navigator</h2><p class="text-xs text-gray-500 sm:text-sm" data-v-536926b5>Let&#39;s get started with your nickname</p></div>',1)),a("div",Yr,[Oe(a("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>d.value.nickname=o),type:"text",placeholder:"Enter your nickname",maxlength:"50",class:"w-full rounded-lg border border-gray-300 px-4 py-3 text-sm text-gray-900 focus:border-green-900 focus:outline-none focus:ring-1 focus:ring-green-900 sm:text-base",onKeyup:mt(ut,["enter"])},null,544),[[Ue,d.value.nickname]]),a("button",{onClick:ut,disabled:!d.value.nickname.trim(),class:xe(["w-full rounded-lg px-4 py-3 text-sm font-medium transition",d.value.nickname.trim()?"bg-green-900 text-white hover:bg-green-800":"cursor-not-allowed bg-gray-200 text-gray-400"])}," Continue ",10,Kr)])])):v(x)===2?(u(),p("div",Wr,[t[37]||(t[37]=a("div",{class:"mb-6 text-center sm:mb-8"},[a("h2",{class:"mb-2 text-xl font-bold text-gray-900 sm:text-2xl"},"Select Your Role"),a("p",{class:"text-xs text-gray-500 sm:text-sm"},"How are you visiting our campus?")],-1)),a("div",Xr,[(u(),p(de,null,we(kt,o=>a("button",{key:o.value,onClick:n=>d.value.role=o.value,class:xe(["flex w-full items-center gap-3 rounded-lg border-2 px-4 py-3 transition",d.value.role===o.value?"border-green-700 bg-green-50":"border-gray-200 hover:border-gray-300"])},[a("span",Qr,y(o.icon),1),a("span",es,y(o.label),1)],10,qr)),64))]),a("div",ts,[a("button",{onClick:Ct,disabled:!d.value.role,class:xe(["w-full rounded-lg px-4 py-3 text-sm font-medium transition",d.value.role?"bg-green-900 text-white hover:bg-green-800":"cursor-not-allowed bg-gray-200 text-gray-400"])}," Start Exploring ",10,os),a("button",{onClick:Pt,class:"w-full rounded-lg px-4 py-3 text-sm font-medium text-gray-600 transition hover:text-gray-900"}," Back ")])])):P("",!0)])])):P("",!0),qe.value?(u(),p("div",{key:1,onClick:ft,class:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 p-4"},[a("div",{onClick:t[13]||(t[13]=pe(()=>{},["stop"])),class:"relative w-full max-w-5xl"},[a("button",{onClick:ft,class:"absolute -top-12 right-0 text-white hover:text-gray-300 transition"},[oe(v(We),{class:"h-8 w-8"})]),a("div",as,[ce.value[q.value]?(u(),p("img",{key:0,src:ce.value[q.value].url,alt:ce.value[q.value].caption||"Photo",class:"w-full max-h-[80vh] object-contain bg-gray-100"},null,8,rs)):P("",!0),a("div",ss,[ce.value[q.value]?.caption?(u(),p("p",ns,y(ce.value[q.value].caption),1)):P("",!0),a("p",ls,y(ce.value[q.value]?.guest?.name||"Guest")+" ‚Ä¢ "+y(Be(ce.value[q.value]?.created_at)),1),a("p",is," Photo "+y(q.value+1)+" of "+y(ce.value.length),1)]),q.value>0?(u(),p("button",{key:1,onClick:Wt,class:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white rounded-full p-3 shadow-lg transition"},[...t[38]||(t[38]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-6 h-6"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})],-1)])])):P("",!0),q.value<ce.value.length-1?(u(),p("button",{key:2,onClick:Kt,class:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white rounded-full p-3 shadow-lg transition"},[...t[39]||(t[39]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-6 h-6"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})],-1)])])):P("",!0)])])])):P("",!0)]),Re.value&&v(i)?(u(),oo(co,{key:0,destination:v(i),"route-points":ye.value,onArStarted:Ft,onArStopped:Tt,onDestinationReached:Rt},null,8,["destination","route-points"])):P("",!0)],64))}},us=uo(cs,[["__scopeId","data-v-536926b5"]]),ds={class:"w-full h-screen overflow-hidden"},Ss={__name:"Index",props:{facilities:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]},polygons:{type:Array,default:()=>[]}},setup(V){return(T,g)=>(u(),p("div",null,[a("div",ds,[oe(us,{facilities:V.facilities,notes:V.notes,polygons:V.polygons},null,8,["facilities","notes","polygons"])])]))}};export{Ss as default};
