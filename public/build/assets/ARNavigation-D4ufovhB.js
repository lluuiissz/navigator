import{r as s,b as N,D as Y,E as ee,G as te,c as w,o as _,g as T,a,t as M,L as d}from"./app-B36RCrEp.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"ar-navigation-container"},ne={key:0,class:"ar-loading"},se={key:1,class:"ar-view"},ie={class:"ar-overlay"},re={class:"mini-map-container"},le={class:"nav-info"},ce={class:"distance"},ue={class:"value"},de={class:"eta"},ve={class:"value"},me={class:"direction"},pe={class:"value"},ge={key:2,class:"ar-error"},he={__name:"ARNavigation",props:{destination:{type:Object,required:!0},routePoints:{type:Array,default:()=>[]}},emits:["ar-started","ar-stopped","destination-reached"],setup($,{emit:L}){const o=$,p=L,v=s(!1),P=s(null),y=s(null),E=s(null),i=s(null),g=s(!1),m=s(null),r=s({lat:0,lng:0,heading:0}),u=s(0),R=s(0),k=s("N"),h=s([]),f=s([]),z=N(()=>u.value<1e3?`${Math.round(u.value)}m`:`${(u.value/1e3).toFixed(2)}km`),G=N(()=>{const e=Math.floor(R.value/60),t=R.value%60;return`${e}:${t.toString().padStart(2,"0")}`});N(()=>{if(o.routePoints.length<=5)return o.routePoints;const t=Math.floor(o.routePoints.length/5),l=[];for(let n=0;n<o.routePoints.length&&(l.push(o.routePoints[n]),!(l.length>=5));n+=t);return l});const C=async()=>{try{if(g.value=!0,m.value=null,console.log("Starting AR Navigation..."),!window.AFRAME)throw new Error("A-Frame not loaded. Please refresh the page.");console.log("A-Frame ready:",window.AFRAME.version),v.value=!0,g.value=!1,await new Promise(e=>setTimeout(e,500)),D(),j(),V(),p("ar-started"),console.log("‚úÖ AR Navigation started with 3D objects")}catch(e){console.error("Failed to start AR:",e),m.value=e.message,g.value=!1,alert("AR initialization failed: "+e.message)}},W=()=>{v.value?x():C()},x=()=>{v.value=!1,S(),i.value&&(i.value.remove(),i.value=null),q(),p("ar-stopped"),console.log("AR Navigation stopped")},D=()=>{if(!P.value||!window.AFRAME){console.error("A-Frame scene not ready");return}console.log("Creating 3D AR objects for",o.routePoints.length,"points"),S();const e=P.value;o.routePoints.forEach((t,l)=>{const n=document.createElement("a-entity");n.setAttribute("gps-entity-place",`latitude: ${t.lat}; longitude: ${t.lng};`),n.setAttribute("geometry","primitive: cone; radiusBottom: 2; radiusTop: 0; height: 5;"),n.setAttribute("material","color: #3B82F6; opacity: 0.8;"),n.setAttribute("rotation","0 0 0"),n.setAttribute("scale","1 1 1"),e.appendChild(n),h.value.push(n);const c=document.createElement("a-entity");c.setAttribute("gps-entity-place",`latitude: ${t.lat}; longitude: ${t.lng};`),c.setAttribute("geometry","primitive: sphere; radius: 1;"),c.setAttribute("material",`color: ${l===o.routePoints.length-1?"#10B981":"#FBBF24"}; opacity: 0.9;`),c.setAttribute("position","0 0.5 0"),e.appendChild(c),f.value.push(c)}),console.log(`‚úÖ Created ${h.value.length} arrows and ${f.value.length} breadcrumbs`)},S=()=>{h.value.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),h.value=[],f.value.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),f.value=[],console.log("AR entities cleared")},j=()=>{if(!E.value)return;i.value=d.map(E.value,{zoomControl:!1,attributionControl:!1,dragging:!1,scrollWheelZoom:!1}).setView([r.value.lat,r.value.lng],17),d.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(i.value);const e=d.divIcon({className:"user-location-marker",html:'<div class="pulse-marker"></div>',iconSize:[20,20]});d.marker([r.value.lat,r.value.lng],{icon:e}).addTo(i.value),d.marker([o.destination.lat,o.destination.lng]).addTo(i.value).bindPopup(o.destination.name),o.routePoints.length>0&&d.polyline(o.routePoints.map(t=>[t.lat,t.lng]),{color:"#3B82F6",weight:3,opacity:.7}).addTo(i.value)};let A=null;const V=()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}A=navigator.geolocation.watchPosition(e=>{r.value={lat:e.coords.latitude,lng:e.coords.longitude,heading:e.coords.heading||0},U(),H()},e=>{console.error("GPS error:",e)},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3}),window.addEventListener("deviceorientationabsolute",b),window.addEventListener("deviceorientation",b)},q=()=>{A!==null&&(navigator.geolocation.clearWatch(A),A=null),window.removeEventListener("deviceorientationabsolute",b),window.removeEventListener("deviceorientation",b)},b=e=>{const t=e.alpha;t!==null&&(r.value.heading=t,O(t))},O=e=>{const t=["N","NE","E","SE","S","SW","W","NW"],l=Math.round(e/45)%8;k.value=t[l]},U=()=>{u.value=Z(r.value.lat,r.value.lng,o.destination.lat,o.destination.lng),R.value=Math.round(u.value/1.4),updateARElements(),u.value<10&&p("destination-reached")},Z=(e,t,l,n)=>{const Q=e*Math.PI/180,X=l*Math.PI/180,F=(l-e)*Math.PI/180,B=(n-t)*Math.PI/180,I=Math.sin(F/2)*Math.sin(F/2)+Math.cos(Q)*Math.cos(X)*Math.sin(B/2)*Math.sin(B/2);return 6371e3*(2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)))},H=()=>{i.value&&i.value.setView([r.value.lat,r.value.lng])},J=()=>{y.value&&y.value.setAttribute("rotation","0 0 0")},K=()=>{m.value=null,p("ar-stopped")};return Y(()=>{console.log("AR Navigation component mounted, auto-starting..."),C()}),ee(()=>{x()}),te(()=>o.routePoints,()=>{v.value&&D()},{deep:!0}),(e,t)=>(_(),w("div",oe,[g.value?(_(),w("div",ne,[...t[0]||(t[0]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Initializing AR Camera...",-1),a("p",{class:"hint"},"Please allow camera and location permissions",-1)])])):v.value?(_(),w("div",se,[a("a-scene",{ref_key:"arScene",ref:P,embedded:"",arjs:"sourceType: webcam; debugUIEnabled: false; videoTexture: true;","vr-mode-ui":"enabled: false",renderer:"logarithmicDepthBuffer: true; alpha: true; antialias: true;",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}},[a("a-camera",{ref_key:"arCamera",ref:y,"gps-camera":"minDistance: 5; maxDistance: 1000;","rotation-reader":""},null,512)],512),a("div",ie,[a("div",re,[a("div",{ref_key:"miniMap",ref:E,class:"mini-map"},null,512)]),a("div",le,[a("div",ce,[t[1]||(t[1]=a("span",{class:"icon"},"üìç",-1)),a("span",ue,M(z.value),1)]),a("div",de,[t[2]||(t[2]=a("span",{class:"icon"},"‚è±Ô∏è",-1)),a("span",ve,M(G.value),1)]),a("div",me,[t[3]||(t[3]=a("span",{class:"icon"},"üß≠",-1)),a("span",pe,M(k.value),1)])]),a("div",{class:"ar-controls"},[a("button",{onClick:W,class:"btn-close-ar"}," ‚úï Exit AR "),a("button",{onClick:J,class:"btn-recenter"}," üéØ Recenter ")])])])):T("",!0),m.value?(_(),w("div",ge,[a("p",null,"‚ùå "+M(m.value),1),a("button",{onClick:K,class:"btn-dismiss"},"Dismiss")])):T("",!0)]))}},we=ae(he,[["__scopeId","data-v-ad2cd062"]]);export{we as A};
